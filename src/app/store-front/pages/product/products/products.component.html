<h1 class="text-3xl font-bold mb-2 mt-6">Productos</h1>

<div class="products-layout grid grid-cols-1 lg:grid-cols-[18%_1fr] gap-4 lg:gap-6 items-start">
  <aside class="filter-card hidden lg:block">
    <h3 class="text-lg font-semibold mb-3">Categorias</h3>
    <ul class="flex flex-col gap-1 max-h-[60vh] overflow-auto pr-1">
      <li>
        <button
          class="filter-item cursor-pointer"
          [class.active]="pendingCategory() === 'all'"
          type="button"
          (click)="selectCategory('all')"
        >
          Todos
        </button>
      </li>
      @for (cat of categories(); track cat.id) {
        <li>
          <button
            class="filter-item cursor-pointer"
            [class.active]="pendingCategory() === cat.id"
            type="button"
            (click)="selectCategory(cat.id)"
          >
            {{ cat.name }}
          </button>
        </li>
      }
    </ul>

    <div class="mt-6">
      <div class="flex items-center justify-between mb-3">
        <h4 class="font-semibold">Tags</h4>
        <button
          class="text-primary text-xs cursor-pointer"
          type="button"
          [disabled]="!selectedTags().size && !pendingTags().size"
          [class.opacity-50]="!selectedTags().size && !pendingTags().size"
          (click)="resetTags()"
        >
          Limpiar
        </button>
      </div>
      <div class="flex flex-wrap gap-2">
        @for (tag of tags(); track tag.id) {
          <button
            type="button"
            class="filter-tag btn btn-sm rounded-md min-h-9 px-4"
            [ngClass]="pendingTags().has(tag.id) ? 'btn-outline border-base-300 bg-base-200 text-base-content font-semibold' : 'btn-outline border-base-300 text-base-content'"
            (click)="toggleTag(tag.id)"
          >
            {{ tag.name }}
          </button>
        }
      </div>
      <div class="flex gap-2 mt-3">
        <button
          type="button"
          class="btn btn-sm flex-1"
          [disabled]="!hasPendingChanges()"
          (click)="applyFilters()"
        >
          Aplicar
        </button>
      </div>
    </div>
  </aside>

  <section class="flex flex-col gap-4">
    <div class="flex flex-wrap gap-3 items-center justify-between">
      <span class="inline-flex items-center gap-2">
        Total de productos
        <span class="font-bold">
          {{ productResponse()?.count === null ? 0 : productResponse()?.count }}
        </span>
      </span>

      <div class="flex items-center justify-end gap-2">
        <label class="opacity-70">Mostrar</label>
        <span class="inline-flex items-center gap-2">
          <select
            class="select select-bordered select-sm w-16 focus-within:outline-none"
            (change)="updateProductsPerPage(+selectPerPage.value)"
            #selectPerPage
          >
            <option [selected]="productPerPage() === 8" value="8">8</option>
            <option [selected]="productPerPage() === 20" value="20">20</option>
            <option [selected]="productPerPage() === 50" value="50">50</option>
            <option [selected]="productPerPage() === 100" value="100">100</option>
          </select>
        </span>
      </div>
    </div>

    @if (loading()) {
      <div class="min-h-[50vh] gap-4">
        <loading />
      </div>
    }

    @if (error()) {
      <p class="text-red-500">{{ error() }}</p>
    }

    @if (!loading() && !error() && productResponse()?.products?.length) {
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 mt-6 gap-4 sm:gap-6 md:gap-8">
        @for (product of productResponse()?.products; track $index) {
          <product-card [product]="product" />
        }
      </div>

      <div class="flex justify-center mt-10">
        <pagination
          [pages]="productResponse()?.pages ?? 0"
          [currentPage]="paginationService.currentPage()"
        ></pagination>
      </div>
    }

    @if (!loading() && !error() && productResponse()?.products?.length === 0) {
      <p>No se encontraron productos</p>
    }
  </section>
</div>
