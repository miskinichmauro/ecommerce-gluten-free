import{a as D}from"./chunk-Q3RP3Q74.js";import{A as g,cb as $,g as d,j as v,r as s,rb as c,s as n,u as r,x as C}from"./chunk-6H3SXBKT.js";var i=`${c.baseUrl}/account`,b=`${c.baseUrl}/orders`,R=`${c.baseUrl}/cart`,O=class h{http=g($);toast=g(D);ordersCache=new Map;ordersRequest=new Map;addressesCache=null;addressesRequest$=null;billingsCache=null;billingsRequest$=null;cacheKey(e,t){return`${e}:${t}`}clearOrdersCache(){this.ordersCache.clear(),this.ordersRequest.clear()}clearAddressesCache(){this.addressesCache=null,this.addressesRequest$=null}clearBillingsCache(){this.billingsCache=null,this.billingsRequest$=null}getProfile(){return this.http.get(`${i}/profile`)}updateProfile(e){return this.toast.activateLoading(),this.http.patch(`${i}/profile`,e).pipe(r(()=>this.toast.activateSuccess()),s(()=>this.toast.deactivateLoading()))}getAddresses(e){return e?.force&&this.clearAddressesCache(),this.addressesCache?d(this.addressesCache):(this.addressesRequest$||(this.addressesRequest$=this.http.get(`${i}/addresses`).pipe(r(t=>this.addressesCache=t??[]),n({bufferSize:1,refCount:!0}),s(()=>this.addressesRequest$=null))),this.addressesRequest$)}createAddress(e){return this.toast.activateLoading(),this.http.post(`${i}/addresses`,e).pipe(r(()=>{this.toast.activateSuccess(),this.clearAddressesCache()}),s(()=>this.toast.deactivateLoading()))}updateAddress(e,t){return this.toast.activateLoading(),this.http.patch(`${i}/addresses/${e}`,t).pipe(r(()=>{this.toast.activateSuccess(),this.clearAddressesCache()}),s(()=>this.toast.deactivateLoading()))}deleteAddress(e){return this.toast.activateLoading(),this.http.delete(`${i}/addresses/${e}`).pipe(r(()=>{this.toast.activateSuccess(),this.clearAddressesCache()}),s(()=>this.toast.deactivateLoading()))}getBillingProfiles(e){return e?.force&&this.clearBillingsCache(),this.billingsCache?d(this.billingsCache):(this.billingsRequest$||(this.billingsRequest$=this.http.get(`${i}/billing`).pipe(r(t=>this.billingsCache=t??[]),n({bufferSize:1,refCount:!0}),s(()=>this.billingsRequest$=null))),this.billingsRequest$)}createBilling(e){return this.toast.activateLoading(),this.http.post(`${i}/billing`,e).pipe(r(()=>{this.toast.activateSuccess(),this.clearBillingsCache()}),s(()=>this.toast.deactivateLoading()))}updateBilling(e,t){return this.toast.activateLoading(),this.http.patch(`${i}/billing/${e}`,t).pipe(r(()=>{this.toast.activateSuccess(),this.clearBillingsCache()}),s(()=>this.toast.deactivateLoading()))}deleteBilling(e){return this.toast.activateLoading(),this.http.delete(`${i}/billing/${e}`).pipe(r(()=>{this.toast.activateSuccess(),this.clearBillingsCache()}),s(()=>this.toast.deactivateLoading()))}getOrders(e=10,t=0,m){let a=this.cacheKey(e,t);m?.force&&this.ordersCache.delete(a);let f=this.ordersCache.get(a);if(f)return d(f);let l=this.ordersRequest.get(a);return l||(l=this.http.get(`${b}?limit=${e}&offset=${t}`,{observe:"response"}).pipe(v(o=>{let u=o.headers.get("x-total-count")??o.headers.get("X-Total-Count"),p=typeof u=="string"&&u.trim()?Number(u):void 0,P=typeof p=="number"&&!Number.isNaN(p)?p:o.body?.length??0;return{items:o.body??[],total:P}}),r(o=>this.ordersCache.set(a,o)),n({bufferSize:1,refCount:!0}),s(()=>this.ordersRequest.delete(a))),this.ordersRequest.set(a,l)),l}getOrder(e){return this.http.get(`${b}/${e}`)}checkoutOrder(e){return this.toast.activateLoading(),this.http.post(`${b}/checkout`,e).pipe(r(()=>{this.toast.activateSuccess(),this.clearOrdersCache()}),s(()=>this.toast.deactivateLoading()))}clearCart(){return localStorage.removeItem("guestCart"),this.http.delete(R).pipe(s(()=>{})).subscribe({complete:()=>{}})}static \u0275fac=function(t){return new(t||h)};static \u0275prov=C({token:h,factory:h.\u0275fac,providedIn:"root"})};export{O as a};
