import{a as v}from"./chunk-Q3RP3Q74.js";import{A as h,cb as b,g as l,r as s,rb as n,s as d,u as i,x as g}from"./chunk-6H3SXBKT.js";var r=`${n.baseUrl}/account`,u=`${n.baseUrl}/orders`,D=`${n.baseUrl}/cart`,f=class c{http=h(b);toast=h(v);ordersCache=new Map;ordersRequest=new Map;addressesCache=null;addressesRequest$=null;billingsCache=null;billingsRequest$=null;cacheKey(e,t){return`${e}:${t}`}clearOrdersCache(){this.ordersCache.clear(),this.ordersRequest.clear()}clearAddressesCache(){this.addressesCache=null,this.addressesRequest$=null}clearBillingsCache(){this.billingsCache=null,this.billingsRequest$=null}getProfile(){return this.http.get(`${r}/profile`)}updateProfile(e){return this.toast.activateLoading(),this.http.patch(`${r}/profile`,e).pipe(i(()=>this.toast.activateSuccess()),s(()=>this.toast.deactivateLoading()))}getAddresses(e){return e?.force&&this.clearAddressesCache(),this.addressesCache?l(this.addressesCache):(this.addressesRequest$||(this.addressesRequest$=this.http.get(`${r}/addresses`).pipe(i(t=>this.addressesCache=t??[]),d({bufferSize:1,refCount:!0}),s(()=>this.addressesRequest$=null))),this.addressesRequest$)}createAddress(e){return this.toast.activateLoading(),this.http.post(`${r}/addresses`,e).pipe(i(()=>{this.toast.activateSuccess(),this.clearAddressesCache()}),s(()=>this.toast.deactivateLoading()))}updateAddress(e,t){return this.toast.activateLoading(),this.http.patch(`${r}/addresses/${e}`,t).pipe(i(()=>{this.toast.activateSuccess(),this.clearAddressesCache()}),s(()=>this.toast.deactivateLoading()))}deleteAddress(e){return this.toast.activateLoading(),this.http.delete(`${r}/addresses/${e}`).pipe(i(()=>{this.toast.activateSuccess(),this.clearAddressesCache()}),s(()=>this.toast.deactivateLoading()))}getBillingProfiles(e){return e?.force&&this.clearBillingsCache(),this.billingsCache?l(this.billingsCache):(this.billingsRequest$||(this.billingsRequest$=this.http.get(`${r}/billing`).pipe(i(t=>this.billingsCache=t??[]),d({bufferSize:1,refCount:!0}),s(()=>this.billingsRequest$=null))),this.billingsRequest$)}createBilling(e){return this.toast.activateLoading(),this.http.post(`${r}/billing`,e).pipe(i(()=>{this.toast.activateSuccess(),this.clearBillingsCache()}),s(()=>this.toast.deactivateLoading()))}updateBilling(e,t){return this.toast.activateLoading(),this.http.patch(`${r}/billing/${e}`,t).pipe(i(()=>{this.toast.activateSuccess(),this.clearBillingsCache()}),s(()=>this.toast.deactivateLoading()))}deleteBilling(e){return this.toast.activateLoading(),this.http.delete(`${r}/billing/${e}`).pipe(i(()=>{this.toast.activateSuccess(),this.clearBillingsCache()}),s(()=>this.toast.deactivateLoading()))}getOrders(e=10,t=0,C){let a=this.cacheKey(e,t);C?.force&&this.ordersCache.delete(a);let p=this.ordersCache.get(a);if(p)return l(p);let o=this.ordersRequest.get(a);return o||(o=this.http.get(`${u}?limit=${e}&offset=${t}`).pipe(i($=>this.ordersCache.set(a,$??[])),d({bufferSize:1,refCount:!0}),s(()=>this.ordersRequest.delete(a))),this.ordersRequest.set(a,o)),o}getOrder(e){return this.http.get(`${u}/${e}`)}checkoutOrder(e){return this.toast.activateLoading(),this.http.post(`${u}/checkout`,e).pipe(i(()=>{this.toast.activateSuccess(),this.clearOrdersCache()}),s(()=>this.toast.deactivateLoading()))}clearCart(){return localStorage.removeItem("guestCart"),this.http.delete(D).pipe(s(()=>{})).subscribe({complete:()=>{}})}static \u0275fac=function(t){return new(t||c)};static \u0275prov=g({token:c,factory:c.\u0275fac,providedIn:"root"})};export{f as a};
