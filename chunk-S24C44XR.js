import{e as l,g as d,i as h,k as g,la as i,m as v,p as u,u as p,ua as f,w as o}from"./chunk-BFZXIPTY.js";var y={baseUrl:"https://api-ecommerce-gluten-free.onrender.com/api"};function k(n,e){let a=!e?.manualCleanup?e?.injector?.get(p)??u(p):null,m=x(e?.equal),s;e?.requireSync?s=o({kind:0},{equal:m}):s=o({kind:1,value:e?.initialValue},{equal:m});let c,b=n.subscribe({next:r=>s.set({kind:1,value:r}),error:r=>{s.set({kind:2,error:r}),c?.()},complete:()=>{c?.()}});if(e?.requireSync&&s().kind===0)throw new g(601,!1);return c=a?.onDestroy(b.unsubscribe.bind(b)),i(()=>{let r=s();switch(r.kind){case 1:return r.value;case 2:throw r.error;case 0:throw new g(601,!1)}},{equal:e?.equal})}function x(n=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&n(e.value,t.value)}var S=`${y.baseUrl}/auth`,D=class n{_authStatus=o("checking");_user=o(null);_token=o(null);http=u(f);checkStatusSignal=k(this.checkStatus(),{initialValue:!1});authStatus=i(()=>this._authStatus()==="checking"?"checking":this._user()?"authenticated":"not-authenticated");user=i(()=>this._user());token=i(()=>this._token());login(e,t){return this.http.post(`${S}/login`,{email:e,password:t}).pipe(d(a=>this.handleLoginSuccess(a)),h(()=>this.handleLoginError()))}checkStatus(){let e=localStorage.getItem("access_token");return e?this.http.get(`${S}/checkStatus`,{headers:{Authorization:`Bearer ${e}`}}).pipe(d(t=>this.handleLoginSuccess(t)),h(()=>this.handleLoginError())):(this.logout(),l(!1))}logout(){this._user.set(null),this._token.set(null),this._authStatus.set("not-authenticated"),localStorage.removeItem("access_token")}handleLoginSuccess(e){return this._user.set(e.user),this._authStatus.set("authenticated"),this._token.set(e.access_token),localStorage.setItem("access_token",e.access_token),!0}handleLoginError(){return this.logout(),l(!1)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=v({token:n,factory:n.\u0275fac,providedIn:"root"})};export{y as a,k as b,D as c};
