import{a as D}from"./chunk-AEYOU25I.js";import{A as f,cb as $,g as l,j as v,r as s,rb as h,s as n,u as i,x as C}from"./chunk-RULOMKSQ.js";var r=`${h.baseUrl}/account`,g=`${h.baseUrl}/orders`,m=`${h.baseUrl}/cart`,O=class c{http=f($);toast=f(D);ordersCache=new Map;ordersRequest=new Map;addressesCache=null;addressesRequest$=null;billingsCache=null;billingsRequest$=null;cacheKey(e,t){return`${e}:${t}`}clearOrdersCache(){this.ordersCache.clear(),this.ordersRequest.clear()}clearAddressesCache(){this.addressesCache=null,this.addressesRequest$=null}clearBillingsCache(){this.billingsCache=null,this.billingsRequest$=null}profileCache=null;profileRequest$=null;getProfile(e){return e?.force&&this.clearProfileCache(),this.profileCache?l(this.profileCache):(this.profileRequest$||(this.profileRequest$=this.http.get(`${r}/profile`).pipe(i(t=>this.profileCache=t),n({bufferSize:1,refCount:!0}),s(()=>this.profileRequest$=null))),this.profileRequest$)}updateProfile(e){return this.toast.activateLoading(),this.http.patch(`${r}/profile`,e).pipe(i(t=>{this.profileCache=t}),i(()=>this.toast.activateSuccess()),s(()=>this.toast.deactivateLoading()))}clearProfileCache(){this.profileCache=null,this.profileRequest$=null}getAddresses(e){return e?.force&&this.clearAddressesCache(),this.addressesCache?l(this.addressesCache):(this.addressesRequest$||(this.addressesRequest$=this.http.get(`${r}/addresses`).pipe(i(t=>this.addressesCache=t??[]),n({bufferSize:1,refCount:!0}),s(()=>this.addressesRequest$=null))),this.addressesRequest$)}createAddress(e){return this.toast.activateLoading(),this.http.post(`${r}/addresses`,e).pipe(i(()=>{this.toast.activateSuccess(),this.clearAddressesCache()}),s(()=>this.toast.deactivateLoading()))}updateAddress(e,t){return this.toast.activateLoading(),this.http.patch(`${r}/addresses/${e}`,t).pipe(i(()=>{this.toast.activateSuccess(),this.clearAddressesCache()}),s(()=>this.toast.deactivateLoading()))}deleteAddress(e){return this.toast.activateLoading(),this.http.delete(`${r}/addresses/${e}`).pipe(i(()=>{this.toast.activateSuccess(),this.clearAddressesCache()}),s(()=>this.toast.deactivateLoading()))}getBillingProfiles(e){return e?.force&&this.clearBillingsCache(),this.billingsCache?l(this.billingsCache):(this.billingsRequest$||(this.billingsRequest$=this.http.get(`${r}/billing`).pipe(i(t=>this.billingsCache=t??[]),n({bufferSize:1,refCount:!0}),s(()=>this.billingsRequest$=null))),this.billingsRequest$)}createBilling(e){return this.toast.activateLoading(),this.http.post(`${r}/billing`,e).pipe(i(()=>{this.toast.activateSuccess(),this.clearBillingsCache()}),s(()=>this.toast.deactivateLoading()))}updateBilling(e,t){return this.toast.activateLoading(),this.http.patch(`${r}/billing/${e}`,t).pipe(i(()=>{this.toast.activateSuccess(),this.clearBillingsCache()}),s(()=>this.toast.deactivateLoading()))}deleteBilling(e){return this.toast.activateLoading(),this.http.delete(`${r}/billing/${e}`).pipe(i(()=>{this.toast.activateSuccess(),this.clearBillingsCache()}),s(()=>this.toast.deactivateLoading()))}getOrders(e=10,t=0,R){let a=this.cacheKey(e,t);R?.force&&this.ordersCache.delete(a);let b=this.ordersCache.get(a);if(b)return l(b);let d=this.ordersRequest.get(a);return d||(d=this.http.get(`${g}?limit=${e}&offset=${t}`,{observe:"response"}).pipe(v(o=>{let u=o.headers.get("x-total-count")??o.headers.get("X-Total-Count"),p=typeof u=="string"&&u.trim()?Number(u):void 0,P=typeof p=="number"&&!Number.isNaN(p)?p:o.body?.length??0;return{items:o.body??[],total:P}}),i(o=>this.ordersCache.set(a,o)),n({bufferSize:1,refCount:!0}),s(()=>this.ordersRequest.delete(a))),this.ordersRequest.set(a,d)),d}getOrder(e){return this.http.get(`${g}/${e}`)}checkoutOrder(e){return this.toast.activateLoading(),this.http.post(`${g}/checkout`,e).pipe(i(()=>{this.toast.activateSuccess(),this.clearOrdersCache()}),s(()=>this.toast.deactivateLoading()))}clearCart(){return localStorage.removeItem("guestCart"),this.http.delete(m).pipe(s(()=>{})).subscribe({complete:()=>{}})}static \u0275fac=function(t){return new(t||c)};static \u0275prov=C({token:c,factory:c.\u0275fac,providedIn:"root"})};export{O as a};
