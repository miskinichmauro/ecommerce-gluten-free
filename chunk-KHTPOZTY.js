import{A as o,Ba as s,La as k,f as h,h as c,j as l,o as p,q as f,t as d,y as m}from"./chunk-5E3BK5GQ.js";function y(n,e){let u=!e?.manualCleanup?e?.injector?.get(m)??d(m):null,a=x(e?.equal),i;e?.requireSync?i=o({kind:0},{equal:a}):i=o({kind:1,value:e?.initialValue},{equal:a});let g,v=n.subscribe({next:r=>i.set({kind:1,value:r}),error:r=>{i.set({kind:2,error:r}),g?.()},complete:()=>{g?.()}});if(e?.requireSync&&i().kind===0)throw new p(601,!1);return g=u?.onDestroy(v.unsubscribe.bind(v)),s(()=>{let r=i();switch(r.kind){case 1:return r.value;case 2:throw r.error;case 0:throw new p(601,!1)}},{equal:e?.equal})}function x(n=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&n(e.value,t.value)}var S={baseUrl:"https://api-ecommerce-gluten-free.onrender.com/api",cantProducts:10};var b=`${S.baseUrl}/auth`,D=class n{_authStatus=o("checking");_user=o(null);_token=o(localStorage.getItem("access_token"));http=d(k);checkStatusSignal=y(this.checkStatus(),{initialValue:!1});authStatus=s(()=>this._authStatus()==="checking"?"checking":this._user()?"authenticated":"not-authenticated");user=s(()=>this._user());token=s(()=>this._token());isAdmin=s(()=>this._user()?.roles.includes("Admin")??!1);login(e,t){return this.http.post(`${b}/login`,{email:e,password:t}).pipe(c(u=>this.handleLoginSuccess(u)),l(()=>this.handleLoginError()))}register(e,t,u){return this.http.post(`${b}/register`,{email:e,password:t,fullName:u}).pipe(c(a=>this.handleLoginSuccess(a)),l(a=>this.handleLoginError()))}checkStatus(){return localStorage.getItem("access_token")?this.http.get(`${b}/check-status`,{}).pipe(c(t=>this.handleLoginSuccess(t)),l(()=>this.handleLoginError())):(this.logout(),h(!1))}logout(){this._user.set(null),this._token.set(null),this._authStatus.set("not-authenticated"),localStorage.removeItem("access_token")}handleLoginSuccess(e){return this._user.set(e.user),this._token.set(e.access_token),this._authStatus.set("authenticated"),localStorage.setItem("access_token",e.access_token),!0}handleLoginError(){return this.logout(),h(!1)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=f({token:n,factory:n.\u0275fac,providedIn:"root"})};export{S as a,y as b,D as c};
